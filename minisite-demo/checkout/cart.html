<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="format-detection" content="telephone=no">
<title>Biotherm 购物车</title>
<meta name="description" content="Biotherm">
<meta name="keywords" content="Biotherm">
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/layout.css">

</head>
<body>
	<header class="bar-checkout">
		<a class="back" href="javascript:void(0)"><img src="images/back.png" alt="返回" /></a>
		<div class="title-checkout">购物车</div>
		<a class="phone" href="tel:4009200503"><img src="images/phone.jpg" alt="免费热线" /></a>
	</header>
    <section class="container checkout" role="scrollable">

    	<div class="edit">
        <span class="left"><a href="">继续购物</a></span>
    		<a id="edit" class="btn btn-primary btn-noradius" href="javascript:void(0)">修改</a>
    	</div>
   		<ul class="item-list">
   			<!-- 正品 -->
   			<li class="goods">
   				<div class="product-edit"><img src="images/delete.png" alt="删除" /></div>
   				<div class="product-img">
                    <img src="images/product-img.jpg" alt="" />
                </div>
   				<div class="product-info">
   					<p>男士活力洁面啫喱</p>
   					<p>数量：<input class="product-num" type="number" readonly="readonly" value="1" /></p>
   					<p class="grey">颜色：蓝色 规格：250ml</p>
   					<p>价格：￥400</p>
   				</div>
   			</li>
   			<li class="goods">
   				<div class="product-edit"><img src="images/delete.png" alt="" /></div>
   				<div class="product-img"><img src="images/product-img.jpg" alt="" /></div>
   				<div class="product-info">
   					<p>男士活力洁面啫喱</p>
   					<p>数量：<input class="product-num" type="number" readonly="readonly" value="1" /></p>
   					<p class="grey">颜色：蓝色 规格：250ml</p>
   					<p>价格：￥400</p>
   				</div>
   			</li>
   			<!-- 小样 -->
   			<li class="sample">
   				<div class="product-img"><img src="images/product-img.jpg" alt="" /></div>
   				<div class="product-info">
   					<p>高保湿清爽洁面霜</p>
   					<p>数量：<input class="product-num" type="number" readonly="readonly" value="1" /></p>
   					<p class="grey">规格：7ml</p>
   					<p>价格：￥0（礼品）</p>
   				</div>
   			</li>
   		</ul>
   		
   		<div class="price">
   			<span class="left"><a id="view-code" href="javascript:void(0)">查看活动代码&gt;</a></span>总金额：<span class="red">￥800</span>
   		</div>

        <div class="integral">
            <p class="blue">积分奖励：恭喜您获得470积分</p>
            <p>该积分为常规积分，不包括特殊活动和促销</p>
            <p>累计积分在碧欧泉官网兑换相应礼品</p>
        </div>
   		
   		<div class="code">
   			<div class="code-title">输入活动代码</div>
   			<div class="code-info">
   				<div><input id="code-str" type="text" placeholder="请输入活动代码" /></div>
   				<div><a id="btn-code" class="btn btn-primary btn-noradius" href="javascript:void(0)">确认</a></div>
   			</div>

   			<div class="code-tips">
				<div class="error hide">很抱歉，您输入的活动代码无效。<br />如有疑问，请拨打咨询热线 4009 200 503</div>
				<div class="success hide">
					<p>活动代码使用成功，您将获得以下赠品。</p>
					<a class="modify-code" href="javascript:void(0)">修改活动代码</a>
					<ul class="sample-list">
						<li class="clear"><span class="left">高保湿清爽洁面霜高保湿清爽洁面霜 1ml</span>数量：1</li>
						<li class="clear"><span class="left">男士活力洁面啫喱</span>数量：1</li>
					</ul>
				</div>
			</div>
   		</div>

        <div class="choose-sample mt10 hide">
            <div class="sample-title">
                您还可以选择 <span class="blue"></span> 个小样
                <span class="sample-close">关闭</span>
            </div>
            <div class="sample-choose-list mt10">
                <div class="sample-type">
                </div>
                <div class="sample-detail mt10 clear">
                </div>
            </div>
            <div class="checkout-submit mt10">
                <button type="button" id="gocounter" class="btn btn-submit btn-block">确定</button>
            </div>
        </div>
    </section>

    <div class="checkout-submit btn-fixed">
        <button type="button" id="gocounter" class="btn btn-submit btn-block">去结算</button>
    </div>
    <!-- 弹出窗口 start -->
    <div class="overload hide">
        <div class="popbg"></div>
        <div class="popmain">
            <div class="pop-close">
                <a href="javascript:void(0)" onclick="closePop()">
                    <span class="close-img"><img src="images/close.jpg" alt="关闭" /></span>关闭
                </a>
            </div>
            <div class="popcontent clear"></div>
        </div>
    </div>

    <div class="popitem hide">
        <!-- 查看活动代码 -->
        <div class="viewCode hide">
            <p class="blue">碧欧泉官网独家礼赠</p>
            <p>官网购物满680/1280/1880元即可任选男士or女士礼赠1份<span class="small">（礼盒不参加本活动）</span></p>
            <p class="nomb">女士礼赠结账时输入<span class="gift-code">FORHER</span></p>
            <p class="nomb">男士礼赠结账时输入<span class="gift-code">FORHIM</span></p>
            <!-- <ul>
                <li>
                    <span class="pop-list">活动1.</span>
                    <span>购买莹白系列或者亮肤系列满500元
                    即可任意挑选一套美白体验套装限量
                    100套送完即止，活动码WHIHER</span>
                </li>
                <li>
                    <span class="pop-list">活动2.</span>
                    <span>购买莹白系列或者亮肤系列满500元
                    即可任意挑选一套美白体验套装限量
                    100套送完即止，活动码WHIHER</span>
                </li><li>
                    <span class="pop-list">活动3.</span>
                    <span>购买莹白系列或者亮肤系列满500元
                    即可任意挑选一套美白体验套装限量
                    100套送完即止，活动码WHIHER</span>
                </li>
            </ul> -->
        </div>
        
        <!-- 删除商品 -->
        <div class="delProduct hide">
            <p>您确定要删除此商品吗？</p>
            <div class="popbtn">
                <a href="javascript:void(0)" onclick="closePop()" class="btn btn-primary btn-two btn-cancel left">取消</a>
                <a href="javascript:void(0)" class="btn btn-two btn-submit right">确认</a>
            </div>
        </div>
    </div>
    <!-- 弹出窗口 end -->
    <script type="text/javascript" src="scripts/zepto.min.js"></script>
    <script type="text/javascript">
        //返回上一页
        $('a.back, .edit>span>a').on('touchend', function() {
            history.go(-1);
        });
        
        //定义弹出窗口
        var popup = function(obj,pos) {
            $('.popcontent').append(obj);
            obj.removeClass('hide');
            $('.popmain').addClass(pos);
            $('.overload').removeClass('hide');
            $('html').css({'overflow': 'hidden'});
        }
        //关闭弹出的窗口
        var closePop = function() {
            $('.overload').addClass('hide');
            $('.popitem').append($('.popcontent').html());
            $('.popmain').removeClass('pos-top pos-bottom');
            $('.popcontent').html('');
            $('html').css({'overflow': 'auto'});
        }

    	$(function() {
            //选小样


            //编辑产品
    		var isedit = true;
    		$('#edit').on('click', function() {
    			if(isedit) {
    				$(this).text('确定');
        			$('.product-edit').addClass('edit-on');
        			$('.goods .product-num').addClass('product-num-edit').removeAttr('readonly');
        			isedit = false;
    			} else {
    				$(this).text('修改');
        			$('.product-edit').removeClass('edit-on');
        			$('.goods .product-num').removeClass('product-num-edit').css({'readonly': 'readonly'});
        			isedit = true;
    			}
    		});

        //删除正品
    		$('.product-edit').on('click', function() {
    			popup($('.delProduct'), 'pos-top');
    		});

        //查看活动代码
        $('#view-code').on('click', function() {
            popup($('.viewCode'), 'pos-top');
        });

        //验证code
		// $('#btn-code').on('click', function() {
		// 	var success = true;//for test
		// 	if(success) {
		// 		$('.success').removeClass('hide');
		// 		$('.code-info').addClass('hide');
		// 	} else {
		// 		$('.error').removeClass('hide');
		// 	}
		// });

        var totalNum, 
            currentNum,
            sampleready = false;

        $('#btn-code').on('click', function() {
            if(!sampleready) {
                $.ajax({
                    url: 'demo.json',
                    cache: false,
                    type: 'get',
                    dataType: 'json',
                    success: function(data) {
                        $('.sample-title>span.blue').text(data.number);
                        totalNum = data.number;
                        currentNum = totalNum;

                        //list the sample type
                        for(var i=0;i<data.sample.length;i++) {
                            var _typelist = '<a href="javascript:void(0)">' + data.sample[i].type +'</a>';
                            $('.sample-type').append(_typelist);
                        }
                        //set the default tab
                        $('.sample-type>a').eq(0).addClass('active');

                        //list the sample infomation
                        for(var i=0;i<data.sample.length;i++) {
                            $('.sample-detail').append('<ul></ul>');
                            for(var j=0;j<data.sample[i].list.length;j++) {
                                $('.sample-detail>ul').eq(i).append('<li></li>');
                                var _piclist = '<div class="sample-pic"><img src="' + data.sample[i].list[j].pic + '" alt="" /></div>';
                                var _namelist = '<div class="sample-name">' + data.sample[i].list[j].name + '</div>';
                                var _selectlist = '<input class="sample-select" type="checkbox" name="sample-select" value="' + data.sample[i].list[j].id + '" />';

                                $('.sample-detail>ul').eq(i).children('li').eq(j).append(_piclist, _namelist, _selectlist);
                                $('.sample-detail>ul').eq(0).addClass('active');
                            }
                        }

                        sampleready = true;

                        //移动小样列表至可视区域
                        $('body').get(0).scrollTop = $('.choose-sample').offset().top - 150;

                        //绑定关闭按钮
                        $('.sample-close').on('click', function() {
                            if($('input[name="sample-select"]:checked').length < data.number) {
                                var con = confirm('您还没有选满小样个数，您确定要放弃吗？');
                                if(con == true) {
                                    $('.choose-sample').addClass('hide');
                                }
                            } else {
                                $('.choose-sample').addClass('hide');
                            }
                        });

                    },
                    error: function() {
                        alert("获取数据失败，请重试");
                    }
                });
            }
            
            $('.code-info').addClass('hide');
            $('.code-tips .success').removeClass('hide');
            $('.sample-list').html('');
            $('.choose-sample').removeClass('hide');
            
        });

        //select samples option
        $(document).on('click', '.sample-detail li', function() {
            var _this = $(this);
            var _theNum = $('.sample-title>span.blue');
            var sampleList = [];
            
           //
            if(_this.hasClass('selected')) {
                _this.children('.sample-select').removeAttr('checked').removeClass('on');
                _this.removeClass('selected');
                $('#' + _this.children('.sample-select').val()).remove();
                var num = $('li.selected').length;
                currentNum = totalNum - num;
                _theNum.text(currentNum);
                
            } else {
                _this.children('.sample-select').attr('checked', true).addClass('on');
                _this.addClass('selected');
                var _list = '<li class="clear" id="' + _this.children('.sample-select').val() + '"><span class="left">' + _this.children('.sample-name').text() + '</span>数量：1</li>';
                var num = $('li.selected').length;
                currentNum = totalNum - num;
                _theNum.text(currentNum);
                if (currentNum >= 0) {
                    $('ul.sample-list').append(_list);
                }
            }

            //判断小样选择个数
            if(currentNum < 0) {
                _theNum.text('0');
                _this.children('.sample-select').removeAttr('checked').removeClass('on');
                _this.removeClass('selected');
                alert('最多只能选择' + totalNum + '个小样');
            }

            //已选中的小样数组
            $('input[name="sample-select"]:checked').each(function() {
                sampleList.push($(this).val());
            });
        });

        //更改code
		$('.modify-code').on('click', function() {
			$('.success').addClass('hide');
			$('.code-info').removeClass('hide');
		});

        /* choose sample tabs */
        $(document).on('click', '.sample-type > a', function(){
            var i = $(this).index();
            $('.sample-type > a').removeClass('active').eq(i).addClass('active');
            $('.sample-detail > ul').removeClass('active').eq(i).addClass('active');
            return false;
        });
    });
    </script>
</body>
</html>